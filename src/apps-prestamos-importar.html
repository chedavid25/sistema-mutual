@@include("partials/main.html")

    <head>
        @@include("partials/title-meta.html", {"title": "Importar Créditos"})
        @@include("partials/head-css.html")
        <style>
            .auth-loading { display: none; }
            .border-dashed { border-style: dashed !important; }
            .bg-opacity-10 { --bs-bg-opacity: 0.1; }
        </style>
    </head>

    <body class="auth-loading">
        <!-- Begin page -->
        <div id="layout-wrapper">

            @@include("partials/menu.html")

            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
            <div class="main-content">

                <div class="page-content">
                    <div class="container-fluid">

                        @@include("partials/page-title.html", {"pagetitle": "Mutual", "title": "Importar Créditos"})
                        
                        <div class="row">
                            <div class="col-xl-9">
                                <div class="card">
                                    <div class="card-header">
                                        <h4 class="card-title">Seleccionar Archivo Excel</h4>
                                        <p class="card-title-desc text-muted">Sube el archivo Excel generado por el sistema de gestión para actualizar masivamente los préstamos y la base de clientes.</p>
                                    </div>
                                    <div class="card-body">
                                        <div id="import-dropzone" class="border-dashed border-2 border-primary p-5 text-center bg-light rounded bg-opacity-10" style="cursor: pointer;">
                                            <i class="display-4 text-primary bx bxs-cloud-upload"></i>
                                            <h4 class="mt-4">Suelte el archivo .xlsx aquí o haga clic para subir</h4>
                                            <p class="text-muted">El sistema procesará automáticamente cuotas y datos de clientes.</p>
                                            <input type="file" id="import-file-input" accept=".xlsx, .xls" class="d-none">
                                        </div>
                                        
                                        <div id="import-progress-container" class="mt-4 d-none">
                                            <div class="d-flex align-items-center justify-content-between mb-2">
                                                <h5 class="font-size-14 mb-0">Progreso de Importación: <span id="import-percentage" class="text-primary">0%</span></h5>
                                                <span id="import-count" class="badge badge-soft-primary font-size-12">0 / 0 filas</span>
                                            </div>
                                            <div class="progress animated-progess custom-progress" style="height: 12px;">
                                                <div id="import-progress-bar" class="progress-bar bg-primary" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                            <div class="mt-3 p-3 bg-light rounded border">
                                                <p id="import-status-text" class="text-muted mb-0 font-size-13"><i class="bx bx-loader bx-spin me-1"></i> Preparando motor de datos...</p>
                                            </div>
                                        </div>

                                        <div id="import-results" class="mt-4 d-none">
                                            <div class="alert alert-success border-0 d-flex align-items-center" role="alert">
                                                <i class="bx bx-check-circle display-6 me-3"></i>
                                                <div>
                                                    <h5 class="alert-heading font-size-16 mb-1">¡Importación Finalizada!</h5>
                                                    <p class="mb-0" id="import-summary-text"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-xl-3">
                                <div class="card bg-primary text-white">
                                    <div class="card-header bg-transparent mb-0 pb-0">
                                        <h4 class="card-title text-white">Instrucciones</h4>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-4">
                                            <h5 class="font-size-14 text-white"><i class="bx bx-file me-1"></i> Formato Requerido</h5>
                                            <p class="text-white-50 font-size-13">Asegúrese de que el archivo contenga las siguientes columnas exactas:</p>
                                            <div class="d-flex flex-wrap gap-2">
                                                <span class="badge bg-white text-primary">CUIT</span>
                                                <span class="badge bg-white text-primary">Numero</span>
                                                <span class="badge bg-white text-primary">Nro Cuota</span>
                                                <span class="badge bg-white text-primary">Monto Total</span>
                                                <span class="badge bg-white text-primary">Saldo Cuota</span>
                                                <span class="badge bg-white text-primary">Fecha</span>
                                            </div>
                                        </div>

                                        <div class="mb-0">
                                            <h5 class="font-size-14 text-white"><i class="bx bx-shield-quarter me-1"></i> Inteligencia de Carga</h5>
                                            <p class="text-white-50 font-size-13 mb-0">El sistema actualiza datos personales de clientes y evita duplicados en las cuotas automáticamente.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div> <!-- container-fluid -->
                </div>
                <!-- End Page-content -->

                @@include("partials/footer.html")
            </div>
            <!-- end main content-->
        </div>
        <!-- END layout-wrapper -->

        @@include("partials/right-sidebar.html")
        @@include("partials/vendor-scripts.html")
        <!-- XLSX Library -->
        <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
        <!-- SweetAlert2 -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        
        <!-- App js -->
        <script src="assets/js/app.js"></script>
        
        <!-- Lógica de Negocio -->
        <script type="module">
            import { guardPage } from './assets/js/role-guard.js';
            guardPage(['super_admin', 'admin']);
        </script>
        <script type="module" src="assets/js/pages/apps-prestamos-importar.init.js"></script>

    </body>
</html>
